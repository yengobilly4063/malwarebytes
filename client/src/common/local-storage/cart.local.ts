import { Cart, CartItem } from "../../models/cart.model";

export const cartData = "cartData";
export const cartDiff = "cartItemsDiff";

export const storeCartInfo = (data: Cart) => {
  localStorage.setItem(cartData, JSON.stringify(data));
};

export const getCartInfo = () => {
  return JSON.parse(localStorage.getItem(cartData) as string) || [];
};

export const addItemToCart = (cartItem: CartItem): Cart => {
  let cart: Cart = getCartInfo();
  let { items } = cart;

  const itemInList = items?.find((item) => item.productId === cartItem.productId);
  if (itemInList) {
    items?.map((item) => {
      if (item.productId === itemInList.productId) {
        item.quantity!++;
      }
    });
  } else {
    items?.push({ ...cartItem, quantity: 1 });
  }
  storeCartInfo(cart);
  return cart;
};

export const removeItemFromCart = (cartItem: CartItem): Cart => {
  let cart: Cart = getCartInfo();
  let { items } = cart;
  const itemInList = items?.find((item) => item.productId === cartItem.productId);
  if (itemInList) {
    items?.map((item) => {
      if (item.productId === itemInList.productId) {
        item.quantity!--;
      }
    });
  }
  storeCartInfo(cart);
  return cart;
};

export const getCurrentCartItem = (id: string): CartItem | null => {
  const { items }: Cart = JSON.parse(localStorage.getItem(cartData) as string) || null;

  const cartItem = items?.find((item) => item.productId === id);
  return cartItem ? cartItem : null;
};
