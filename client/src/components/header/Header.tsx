import React from "react";
import { useDispatch, useSelector } from "react-redux";
import { Link } from "react-router-dom";
import { logoutUser } from "../../store/reducers/auth/auth.action-creators";
import { getAuthUserState } from "../../store/reducers/auth/auth.reducer";
import { getCartState } from "../../store/reducers/cart/cart.reducer";
import Container from "../container/Container";
import styles from "./Header.module.scss";

const Header: React.FC = () => {
  const { user, isAuth } = useSelector(getAuthUserState);
  const { cart } = useSelector(getCartState);

  const dispatch = useDispatch();

  const handleLogout = () => {
    dispatch(logoutUser());
  };

  const getCartItemMessage = () => {
    if (!cart?.items) {
      return 0;
    }
    return cart?.items?.filter((item) => item.quantity !== 0).length;
  };

  return (
    <div className={styles.wrapper}>
      <Container>
        <div className={styles.content}>
          <Link className={styles.logo} to="/">
            MalwareBytes
          </Link>
          <div className={styles.cart}>
            {user && (
              <span className={styles.user}>
                <span className={styles.username}>{` ${user.name}`}</span>
              </span>
            )}
            <span>
              Total in cart: <span className={styles.cartItems}>{`${getCartItemMessage()} item (s)`}</span>
            </span>
            {isAuth && (
              <span className={styles.logout} onClick={handleLogout}>
                logout
              </span>
            )}
          </div>
        </div>
      </Container>
    </div>
  );
};

export default Header;
