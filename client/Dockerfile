FROM node:12-alpine AS build

RUN mkdir -p /malwarebytes

WORKDIR /malwarebytes

COPY package.json ./
COPY package-lock.json ./


RUN npm i --only-development

COPY . .

RUN npm run build


# Deploy stage

FROM node:12-alpine as deploy

LABEL name=malwarebytes

WORKDIR /malwarebytes

COPY --from=build /malwarebytes/node_modules ./node_modules
COPY --from=build /malwarebytes/build ./build

COPY package.json ./

RUN npm i --only-production

COPY . .

ENV PORT=3000
ENV NODE_ENV=production

RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

EXPOSE $PORT

CMD npm run start